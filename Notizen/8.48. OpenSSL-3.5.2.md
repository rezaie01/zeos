#OpenSSL #openssl #c_rehash #libcrypto #libssl

## üõ†Ô∏è OpenSSL-3.5.2: Lernnotizen f√ºr LFS

### 1. Paketfunktion

- OpenSSL enth√§lt **Verwaltungswerkzeuge und Bibliotheken** im Zusammenhang mit Kryptographie.
    
- Stellt kryptographische Funktionen f√ºr andere Pakete bereit (z.B. OpenSSH, E-Mail-Anwendungen, Webbrowser f√ºr **HTTPS**).
    

---

### 2. Kompilierungsprozess

#### **Vorbereitung**

- Konfiguration des Pakets:
    ```
    ./config --prefix=/usr \
             --openssldir=/etc/ssl \
             --libdir=lib \
             shared \
             zlib-dynamic
    ```
    
    - `--openssldir=/etc/ssl`: Setzt das Verzeichnis f√ºr Konfigurationen.
        
    - `--libdir=lib`: Stellt sicher, dass Bibliotheken in `/usr/lib` landen.
        
    - `shared`: Baut Shared Libraries (dynamische Bibliotheken).
        
    - `zlib-dynamic`: Erm√∂glicht die dynamische Bindung an `zlib`.
        

#### **Kompilierung und Test**

- Kompilierung: `make`
    
- Testdurchf√ºhrung: `HARNESS_JOBS=$(nproc) make test`
    
- **Wichtiger Punkt:** Ein Test (`30-test_afalg.t`) kann fehlschlagen, wenn dem Host-Kernel bestimmte Krypto-Konfigurationen (z.B. `CONFIG_CRYPTO_USER_API_SKCIPHER`) fehlen. **Dies kann sicher ignoriert werden.**
    

#### **Installation**

- Entfernen der statischen Bibliotheken aus dem `Makefile` vor der Installation (LFS verwendet nur Shared Libraries):
    ```
    sed -i '/INSTALL_LIBS/s/libcrypto.a libssl.a//' Makefile
    ```
    
- Installation des Pakets:
    ```
    make MANSUFFIX=ssl install
    ```
    
- Anpassung des Dokumentationsverzeichnisses f√ºr Konsistenz:
    ```
    mv -v /usr/share/doc/openssl /usr/share/doc/openssl-3.5.2
    ```
    
- (Optional) Installation zus√§tzlicher Dokumentation:
    ```
    cp -vfr doc/* /usr/share/doc/openssl-3.5.2
    ```
    

---

### 3. Nach-der-Installation-Konfigurationen & Update-Hinweise

- **Installierte Verzeichnisse:** `/etc/ssl` (Konfigurationen, Zertifikate), `/usr/include/openssl` (Header-Dateien), `/usr/lib/engines` (Krypto-Engines), `/usr/share/doc/openssl-3.5.2` (Dokumentation).
    
- **Update-Richtlinie:**
    
    - OpenSSL sollte bei Bekanntwerden von Sicherheitsl√ºcken aktualisiert werden.
        
    - Versionierungsschema: `MAJOR.MINOR.PATCH` (z.B. 3.5.2).
        
    - **API/ABI-Kompatibilit√§t** ist bei gleicher `MAJOR`-Versionsnummer garantiert.
        
    - Da LFS nur Shared Libraries (`.so`) installiert, ist bei Upgrades mit gleicher `MAJOR`-Nummer **keine Neukompilierung** von Paketen erforderlich, die gegen OpenSSL linken.
        
    - **WICHTIG:** Alle **laufenden Programme**, die `libcrypto.so` oder `libssl.so` verwenden, m√ºssen **gestoppt und neu gestartet werden**, um die aktualisierten Bibliotheken zu laden.
        

---

### 4. Essenzielle Programme und Bibliotheken

|Programm / Bibliothek|Beschreibung|Nutzung (Fokus: Systemintegration)|
|---|---|---|
|**`libcrypto.so`**|Implementiert eine breite Palette von **kryptographischen Algorithmen** (z.B. AES, RSA, SHA-256).|Grundlegende Bibliothek, die von fast allen sicheren Diensten genutzt wird: **OpenSSL (TLS/SSL), OpenSSH, OpenPGP** und S/MIME.|
|**`libssl.so`**|Implementiert das **Transport Layer Security (TLS v1)** Protokoll.|Stellt die API f√ºr die Implementierung von **sicherer Client/Server-Kommunikation (HTTPS, IMAPS, etc.)** bereit. Nutzt `libcrypto.so` f√ºr die Algorithmen.|
|#c_rehash|Ein Perl-Skript, das symbolische Links zu Zertifikaten basierend auf ihren Hash-Werten erstellt.|**Veraltet.** Sollte nicht mehr direkt genutzt werden. Die Funktionalit√§t wird durch `openssl rehash` ersetzt.|
|#openssl|**Das Haupt-Befehlszeilenwerkzeug** zur Nutzung der Krypto-Funktionen der OpenSSL-Bibliothek.|**Extrem wichtig f√ºr System-/Netzwerkadministration.** Aufgeteilt in Subkommandos:<br><br>  <br>  <br><br>**1. SSL/TLS-Tests (Netzwerk):**<br><br>  <br><br>* `openssl s_client -connect <host>:<port>`: Stellt eine TLS-Verbindung zu einem Server her (z.B. `google.com:443`). Zeigt die Zertifikatskette und Handshake-Informationen an. Unverzichtbar f√ºr das Debugging von HTTPS/TLS-Problemen.<br><br>  <br>  <br><br>**2. Zertifikatsmanagement (X.509):**<br><br>  <br><br>* `openssl x509 -in <cert.pem> -text -noout`: Liest ein Zertifikat (PEM-Format) und zeigt den Inhalt an (Aussteller, G√ºltigkeit, Subject, Public Key).<br><br>  <br><br>* `openssl req -new -key <key.pem> -out <csr.pem>`: Erstellt einen **Certificate Signing Request (CSR)**. Dies ist der Antrag, den man bei einer Certificate Authority (CA) einreicht.<br><br>  <br><br>* `openssl req -new -x509 -keyout <key.pem> -out <cert.pem> -days 365`: Erstellt ein **selbstsigniertes Zertifikat** (z.B. f√ºr Testumgebungen).<br><br>  <br>  <br><br>**3. Schl√ºsselgenerierung:**<br><br>  <br><br>* `openssl genrsa -out <private.key> 2048`: Generiert einen 2048-Bit **RSA Private Key**.<br><br>  <br>  <br><br>**4. Ver-/Entschl√ºsselung (Dateien):**<br><br>  <br><br>* `openssl enc -aes-256-cbc -salt -in <klartext.txt> -out <geheim.enc>`: Verschl√ºsselt eine Datei mit AES-256.<br><br>  <br><br>* `openssl enc -d -aes-256-cbc -in <geheim.enc> -out <klartext.txt>`: Entschl√ºsselt die Datei.<br><br>  <br>  <br><br>**5. Hashing / Digests:**<br><br>  <br><br>* `openssl dgst -sha256 <datei.txt>`: Berechnet den SHA-256-Hash einer Datei.<br><br>  <br>  <br><br>**6. Hilfsprogramme:**<br><br>  <br><br>* `openssl rehash <verzeichnis>` (z.B. `/etc/ssl/certs`): F√ºhrt die Funktion von `c_rehash` aus (Aktualisierung der Symlinks f√ºr Zertifikate).|