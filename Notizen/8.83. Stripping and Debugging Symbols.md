#stripping

# Stripping and Debugging Symbols

- Zweck: Entfernen von Debug-Symbolen zur Reduktion der Systemgröße; ausgewählte Debug-Infos werden separat gespeichert.
- Risiko: Fehlerhaftes Stripping kann laufende Prozesse/gesamtes System unbrauchbar machen. Backup empfohlen.
- Unterschied: --strip-unneeded entfernt mehr Symboltabellen als --strip-debug; Größenunterschied oft klein.

## Prozessüberblick — wichtigste Punkte

- Ausgewählte Bibliotheken Debug-Infos extrahieren, komprimieren und als *.dbg speichern.
- Binärdateien und Bibliotheken nicht direkt im laufenden Pfad strippen; in /tmp kopieren, strippen, dann mit install zurückkopieren.
- Liste von „online“ Bibliotheken/Binaries ausschließen (werden live benutzt) und separat behandeln.
- Nach Stripping ggf. vorhandene Debug-Dateien (.dbg) als Referenz belassen für Debug/Tests.

### Exakte Befehle / Ablauf (wie im Buch)

```bash
save_usrlib="$(cd /usr/lib; ls ld-linux*[^g] )
libc.so.6
libthread_db.so.1
libquadmath.so.0.0.0
libstdc++.so.6.0.34
libitm.so.1.0.0
libatomic.so.1.2.0"
```

```bash
cd /usr/lib

for LIB in $save_usrlib; do
objcopy --only-keep-debug --compress-debug-sections=zstd $LIB $LIB.dbg
cp $LIB /tmp/$LIB
strip --strip-debug /tmp/$LIB
objcopy --add-gnu-debuglink=$LIB.dbg /tmp/$LIB
install -vm755 /tmp/$LIB /usr/lib
rm /tmp/$LIB
done
```

```bash
online_usrbin="bash find strip"
online_usrlib="libbfd-2.45.so
libsframe.so.2.0.0
libhistory.so.8.3
libncursesw.so.6.5
libm.so.6
libreadline.so.8.3
libz.so.1.3.1
libzstd.so.1.5.7
$(cd /usr/lib; find libnss *.so* -type f)"
```

```bash
for BIN in $online_usrbin; do
cp /usr/bin/$BIN /tmp/$BIN
strip --strip-debug /tmp/$BIN
install -vm755 /tmp/$BIN /usr/bin
rm /tmp/$BIN
done
for LIB in $online_usrlib; do
cp /usr/lib/$LIB /tmp/$LIB
strip --strip-debug /tmp/$LIB
install -vm755 /tmp/$LIB /usr/lib
rm /tmp/$LIB
done
```

```bash
for i in $(find /usr/lib -type f -name \*.so\* ! -name \*dbg) \
$(find /usr/lib -type f -name \*.a) \
$(find /usr/{bin,sbin,libexec} -type f); do
case "$online_usrbin $online_usrlib $save_usrlib" in
*$(basename $i)* )
  ;;
* )
  strip --strip-debug $i
  ;;
esac
done

unset BIN LIB save_usrlib online_usrbin online_usrlib
```

## Nachbereitung / Hinweise

- Prüfen, ob LD loader Name in save_usrlib korrekt ist (ld-linux*.so); bei Versionsabweichung anpassen.
- Separat gespeicherte .dbg-Dateien ermöglichen späteres Debugging ohne vollständige Binärdatei wiederherstellen.
- Stripping kann laufende Prozesse beeinflussen; möglichst in ruhendem System oder chroot-sichere Reihenfolge durchführen.

---

#cleaning-up

# Cleaning Up (Endaufgaben)

- Entfernt temporäre Testdateien, libtool-Archive (.la), Reste des temporären Compilers und den Testnutzer.

### Exakte Befehle / Schritte (wie im Buch)

```bash
rm -rf /tmp/{*, .*
}
```

```bash
find /usr/lib /usr/libexec -name \*.la -delete
```

```bash
find /usr -depth -name $(uname -m)-lfs-linux-gnu\* | xargs rm -rf
```

```bash
userdel -r tester
```

### Wichtige Punkte

- .la-Dateien können BLFS-Builds stören; sicher entfernen.
- Entfernen des temporären Compilers befreit /usr von Build-Artefakten.
- Entfernen des Tester-Kontos beendet nicht benötigte Test-Benutzerressourcen.