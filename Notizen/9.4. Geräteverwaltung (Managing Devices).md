
## 9.4. Geräteverwaltung (Managing Devices)

## 9.4.1. Netzwerkgeräte (Network Devices)

Udev ist das System, das standardmäßig dafür sorgt, dass Netzwerkgeräte konsistent benannt werden. Das ist wichtig, weil in älteren Linux-Versionen die Namen der Netzwerkkarten (z. B. `eth0` und `eth1`) nach einem Neustart oft zufällig vertauscht wurden.

*   **Der neue Standard:** Udev nutzt jetzt Namen wie `enp5s0` oder `wlp3s0`. Diese basieren auf physischen Merkmalen wie dem Bus, dem Slot oder der MAC-Adresse der Karte, um sicherzustellen, dass der Name immer gleich bleibt, unabhängig davon, wann die Karte entdeckt wurde.

### 9.4.1.1. Deaktivierung der persistenten Benennung in der Kernel-Befehlszeile

Wenn du die alten, traditionellen Namen (`eth0`, `eth1` usw.) bevorzugst, kannst du diese wiederherstellen.

*   **Wie es geht:** Du musst einfach die Option `net.ifnames=0` zur Kernel-Befehlszeile hinzufügen.
*   **Wo es hingehört:** Diese Befehlszeile befindet sich in der GRUB Konfigurationsdatei.
*   **Wann es sinnvoll ist:** Diese Methode ist ideal für Systeme, die nur eine Netzwerkkarte eines bestimmten Typs besitzen, wie zum Beispiel viele Laptops.

### 9.4.1.2. Erstellen benutzerdefinierter Udev-Regeln

Du hast die Möglichkeit, eigene Regeln zu erstellen, um die Benennung deiner Netzwerkkarten anzupassen.

1.  **Regeln generieren:** Zuerst erzeugst du die Startregeln, indem du das Skript `/usr/lib/udev/init-net-rules.sh` ausführst.
2.  **Regel-Datei:** Die generierten Regeln findest du in der Datei `/etc/udev/rules.d/70-persistent-net.rules`.
3.  **Inhalt der Regeln:**
    *   Die Datei enthält eine kommentierte Zeile mit Referenzinformationen zur Hardware (wie PCI-IDs und Treiber), aber diese Infos werden **nicht** zur tatsächlichen Namensgebung verwendet.
    *   Die nächste Zeile ist die eigentliche udev-Regel, die das Gerät identifiziert und ihm einen Namen zuweist.
4.  **Wichtige Schlüsselwörter in den Regeln:**
    *   `SUBSYSTEM=="net"`: Stellt sicher, dass die Regel nur für Netzwerkkarten gilt.
    *   `ACTION=="add"`: Die Regel wird nur ausgeführt, wenn eine Karte hinzugefügt wird.
    *   `DRIVERS=="?*"`: Ignoriert virtuelle Schnittstellen (wie VLANs), um Namenskollisionen zu verhindern.
    *   `ATTR{address}`: Die MAC-Adresse der Netzwerkkarte.
    *   `ATTR{type}=="1"`: Stellt sicher, dass nur die primäre Schnittstelle erfasst wird (wichtig bei einigen WLAN-Treibern, die virtuelle Schnittstellen erstellen).
    *   `NAME`: Der zugewiesene Name (das ist der Wert, den du für deine Netzwerkkonfiguration brauchst).

*   **Probleme mit alternativen Namen:** Manchmal schlägt eine benutzerdefinierte Regel fehl, weil udev bereits einen alternativen Namen für eine Karte zugewiesen hat, der mit deinem Wunschnamen kollidiert. Du kannst dies beheben, indem du die Richtlinie `AlternativeNamesPolicy` in der Datei `/etc/udev/network/99-default.link` leer setzt.

## 9.4.2. CD-ROM Symlinks

Viele Software (wie Media Player) erwarten, dass die Symlinks **/dev/cdrom** und **/dev/dvd** existieren und auf das entsprechende Laufwerk zeigen.

Udev kann Regeln erstellen, um diese Links zu generieren, aber du musst zwischen zwei Modi wählen:

| Modus | Beschreibung | Ideal für... |
| :--- | :--- | :--- |
| **"by-id"-Modus** | Die Regel basiert auf **Identifikationszeichenfolgen**, die auf dem Laufwerk gespeichert sind (gelesen von `ata_id` oder `scsi_id`). Standard für IDE und SCSI. | Wenn der **physische Anschluss** des Laufwerks sich ändert (z. B. Umstecken an einen anderen Port). |
| **"by-path"-Modus** | Die Regel basiert auf dem **physischen Pfad** zum Gerät (Ports und Slots). Standard für USB und FireWire. | Wenn das **Gerät** selbst ausgetauscht wird, aber im selben Anschluss bleibt. |

*   **Achtung bei Externen Geräten:** Externe USB-Laufwerke sollten den "by-path"-Modus nicht verwenden, da sich ihr physischer Pfad bei jedem Anschluss an einem neuen Port ändert.
*   Der Modus kann in der Datei `/etc/udev/rules.d/83-cdrom-symlinks.rules` geändert werden.

## 9.4.3. Umgang mit duplizierten Geräten (Dealing with Duplicate Devices)

Geräte mit der gleichen Funktion (außer Netzwerkkarten und Soundkarten), wie z. B. eine USB-Webcam und ein TV-Tuner, erhalten zufällige Namen wie **/dev/video0** und **/dev/video1**. Nach einem Neustart kann sich die Reihenfolge ändern.

*   **Die Lösung:** Man erstellt **persistente Symlinks**.
*   **Vorgehen:**
    1.  Du musst die **eindeutigen Attribute** des Geräts (wie Vendor- und Produkt-IDs) herausfinden. Dies kannst du mit dem Befehl `udevadm info -a -p /sys/class/video4linux/video0` machen.
    2.  Anschließend schreibst du eine udev-Regel, die diese Attribute nutzt, um dauerhafte Symlinks zu erstellen.
*   **Ergebnis:** Die ursprünglichen, zufälligen Gerätenamen (`/dev/video0`) sollten nie direkt verwendet werden. Stattdessen nutzt du die neuen, persistenten Symlinks, wie z. B. **/dev/webcam** oder **/dev/tvtuner**, die immer auf das korrekte Gerät zeigen.


# Glossar zur Geräteverwaltung 

**ACTION=="add"** : Das ist ein Befehl in den udev-Regeln. Er sagt udev, dass die Regel nur ausgeführt werden soll, wenn ein Gerät **hinzugefügt** wird (also beim Start oder Anschließen). Bei Geräten, die entfernt oder geändert werden, soll diese Regel ignoriert werden.

**AlternativeNamesPolicy** : Udev versucht manchmal, Netzwerkkarten alternative Namen zuzuweisen. Wenn du eigene Regeln erstellst und der gewünschte Name schon als alternativer Name für eine andere Karte reserviert ist, schlägt deine Regel fehl. Mit dieser Richtlinie kannst du die Zuweisung alternativer Namen ausschalten, indem du die Datei `/etc/udev/network/99-default.link` änderst.

**ATTR{address}** : Dieses udev-Schlüsselwort steht für die **MAC-Adresse** der Netzwerkkarte (NIC). Es hilft, die Karte eindeutig zu identifizieren.

**ATTR{type}=="1"** : Dieses udev-Schlüsselwort ist wichtig, damit nur die **primäre Schnittstelle** einer Netzwerkkarte erkannt wird. Bestimmte WLAN-Treiber erstellen manchmal zusätzliche virtuelle Schnittstellen. Dieses Schlüsselwort verhindert, dass diese virtuellen Schnittstellen denselben Namen wie die Hauptkarte bekommen (was eine Namenskollision wäre).

**"by-id"-Modus** : Eine Methode, um Symlinks für CD-ROM/DVD-Laufwerke zu erstellen (z. B. `/dev/cdrom`). Dieser Modus identifiziert das Laufwerk anhand von **Identifikationszeichenfolgen**, die direkt auf dem Gerät gespeichert sind (gelesen von Programmen wie `ata_id` oder `scsi_id`). Dieser Modus ist gut, wenn du erwartest, dass sich der **physische Anschluss** des Laufwerks ändert (z. B. wenn du das Laufwerk an einen anderen Port steckst). Standardmäßig wird er für IDE- und SCSI-Geräte verwendet.

**"by-path"-Modus** : Eine andere Methode für CD-ROM/DVD-Symlinks. Dieser Modus identifiziert das Laufwerk anhand seines **physischen Pfades** (Ports und Slots, wo es angeschlossen ist). Dieser Modus ist nützlich, wenn du erwartest, dass das Gerät selbst ausgetauscht wird, aber im selben Anschluss verbleibt. Er ist der Standard für USB- und FireWire-Geräte.

**CD-ROM Symlinks** : Das sind spezielle Links wie **/dev/cdrom** und **/dev/dvd**. Einige Programme (wie Media Player) erwarten, dass diese Links existieren und auf das CD/DVD-Gerät zeigen.

**DRIVERS=="?*"** : Dieses udev-Schlüsselwort wird verwendet, um **VLAN- oder Bridge-Sub-Schnittstellen** zu ignorieren. Diese haben keinen eigenen Treiber (daher das `?*`, was „hat einen Wert“ bedeutet). Sie werden übersprungen, weil sie sonst Namenskollisionen mit ihren Hauptgeräten verursachen würden.

**Duplicate Devices (Duplizierte Geräte)** : Das beschreibt das Problem, wenn man mehrere Geräte der gleichen Art hat (z. B. eine Webcam und einen TV-Tuner). Die Reihenfolge, in der sie in `/dev` erscheinen (z. B. `/dev/video0` oder `/dev/video1`), ist **zufällig** und kann sich nach einem Neustart ändern.

**GRUB Konfigurationsdatei** : Die Datei, die die Befehle für den Kernel enthält. Hier kannst du die Option `net.ifnames=0` hinzufügen, um das alte, traditionelle Namensschema für Netzwerkkarten wiederherzustellen.

**Hardware IDs/Treiber (Reference)** : Im Regelwerk `/etc/udev/rules.d/70-persistent-net.rules` stehen in den Kommentaren die Hardware-IDs (wie PCI-IDs) und der Treiber der Netzwerkkarte. Diese Informationen dienen nur als **Referenz** und werden nicht zur tatsächlichen Namensgebung verwendet.

**NAME** : Das ist ein sehr wichtiges udev-Schlüsselwort. Der Wert, den du hier festlegst, ist der **Name**, den udev der Netzwerkschnittstelle zuweist. Diesen Namen musst du später in deinen Netzwerkkonfigurationsdateien verwenden.

**net.ifnames=0** : Dies ist eine Option für die Kernel-Befehlszeile. Wenn du sie benutzt, wird das alte, **traditionelle Namensschema** (wie `eth0`, `eth1`) für Netzwerkkarten wiederhergestellt, anstatt der neuen Namen wie `enp5s0`.

**Netzwerkgeräte (Neu, Standard)** : Dies sind die aktuellen, **konsistenten** Namen, die udev standardmäßig vergibt, wie zum Beispiel **enp5s0** oder **wlp3s0**. Der Vorteil ist, dass die Namen immer gleich bleiben, auch wenn du den Computer neu startest.

**Netzwerkgeräte (Traditionell)** : Das ist das ältere Namensschema, bei dem Karten **eth0**, **eth1** usw. genannt wurden. Hier konnte es passieren, dass die Karten nach einem Neustart unterschiedliche Nummern bekamen.

**Persistent Symlinks (Lösung für Duplikate)** : Das sind spezielle, dauerhafte Symlinks (z. B. **/dev/webcam**). Diese werden durch benutzerdefinierte udev-Regeln erstellt, um sicherzustellen, dass sie immer auf das richtige Gerät zeigen, selbst wenn die zufälligen Geräte-Knoten (`/dev/video0`) ihre Zuweisung ändern.

**SUBSYSTEM=="net"** : Dieses udev-Schlüsselwort am Anfang einer Regel sorgt dafür, dass udev nur Geräte berücksichtigt, die **Netzwerkkarten** sind, und alle anderen Geräte ignoriert.

**sysfs Filesystem** : Ein Dateisystem (zu finden unter `/sys`), in dem Informationen und Attribute zu allen Geräten gespeichert sind. Udev nutzt diese Attribute (z. B. Vendor- oder Produkt-IDs), um Geräte zu identifizieren.

**udev** : Das System, das für die **Geräteverwaltung** zuständig ist. Udev sorgt standardmäßig dafür, dass Geräte, insbesondere Netzwerkkarten, konsistente Namen erhalten, damit sie nach einem Neustart nicht durcheinander geraten.

**`/etc/udev/rules.d/70-persistent-net.rules`** : Die Datei, in der die Regeln zur **dauerhaften Benennung** deiner Netzwerkkarten gespeichert sind. Diese wird durch ein Skript erzeugt, wenn du die benutzerdefinierte Namensgebung einrichtest.

**`/etc/udev/rules.d/83-cdrom-symlinks.rules`** : Die Datei, in der die Regeln für die CD-ROM Symlinks (wie `/dev/cdrom`) gespeichert sind. Hier kann der Modus ("by-id" oder "by-path") geändert werden.