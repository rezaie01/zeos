#Coreutils #ls #cp #mv #rm #chmod #chown #dd #cat #head #tail #df #du #tee

## üõ†Ô∏è Coreutils-9.7: Lernnotizen f√ºr LFS

### 1. Paketfunktion

- Das Coreutils-Paket enth√§lt die **grundlegenden Dienstprogramme**, die von jedem Betriebssystem ben√∂tigt werden. Dies umfasst Werkzeuge f√ºr Datei-, Shell- und Textmanipulation.
    

---

### 2. Kompilierungsprozess

#### **Vorbereitung (Patches)**

- Anwendung eines Upstream-Sicherheitsfixes:
    ```
    patch -Np1 -i ../coreutils-9.7-upstream_fix-1.patch
    ```
    
- Anwendung eines Patches zur Behebung von Internationalisierungs- (i18n) und Multibyte-Locale-Fehlern:
    ```
    patch -Np1 -i ../coreutils-9.7-i18n-1.patch
    ```
    

#### **Build-System-Regeneration**

- Der i18n-Patch modifiziert das Build-System; eine Regeneration der Konfigurationsdateien ist erforderlich.
    ```
    autoreconf -fv
    ```
    
- `automake` wird separat ausgef√ºhrt, da `autoreconf` (ohne `-i`) die Hilfsdateien nicht aktualisiert hat:
    ```
    automake -af
    ```
    

#### **Konfiguration**

- Konfiguration des Pakets:
    ```
    FORCE_UNSAFE_CONFIGURE=1 ./configure \
        --prefix=/usr \
        --enable-no-install-program=kill,uptime
    ```
    
- **Wichtige Punkte:**
    
    - `FORCE_UNSAFE_CONFIGURE=1`: Diese Umgebungsvariable ist **erforderlich**, um den Build als `root`-Benutzer in der `chroot`-Umgebung zu erlauben.
        
    - `--enable-no-install-program=kill,uptime`: Verhindert die Installation von `kill` und `uptime`, da diese Programme von anderen Paketen (Util-linux, Procps) bereitgestellt werden.
        

#### **Kompilierung und Test**

- Kompilierung: `make`
    
- **Testdurchf√ºhrung (WICHTIG):**
    
    - Root-Tests: `make NON_ROOT_USERNAME=tester check-root`
        
    - Setup f√ºr Nicht-Root-Tests (erstellt tempor√§ren Benutzer/Gruppe):
        ```
        groupadd -g 102 dummy -U tester
        chown -R tester .
        ```
        
    - Ausf√ºhrung der Haupttests als Benutzer `tester`:
        ```
        su tester -c "PATH=$PATH make -k RUN_EXPENSIVE_TESTS=yes check" \
         < /dev/null
        ```
        
    - **Kritischer Punkt:** Die Umleitung `< /dev/null` verhindert, dass Tests fehlschlagen, die eine PTY (Pseudo-Terminal) im `chroot` erwarten.
        
    - Bereinigung: `groupdel dummy`
        

#### **Installation**

- Installation: `make install`
    

---

### 3. Nach-der-Installation-Konfigurationen

- **FHS-Anpassung:** Das Programm `chroot` wird als Administrationswerkzeug nach `/usr/sbin` verschoben.
    ```
    mv -v /usr/bin/chroot /usr/sbin
    ```
    
- **Manpage-Anpassung:** Die zugeh√∂rige Manpage wird von Sektion 1 (Benutzerbefehle) nach Sektion 8 (Admin-Befehle) verschoben und der Sektionsverweis intern angepasst.
    ```
    mv -v /usr/share/man/man1/chroot.1 /usr/share/man/man8/chroot.8
    sed -i 's/"1"/"8"/' /usr/share/man/man8/chroot.8
    ```
    

---

### 4. Essenzielle Programme und ihre Nutzung

|Programm|Nutzung (Fokus: Systemintegration)|
|---|---|
|#ls|**Listet Verzeichnisinhalte auf.**<br><br>  <br><br>**Nutzung:** `ls -l` (langes Format), `ls -a` (zeigt versteckte Dateien), `ls -lh` (langes Format, lesbare Gr√∂√üen), `ls -R` (rekursiv).|
|#cp|**Kopiert Dateien und Verzeichnisse.**<br><br>  <br><br>**Nutzung:** `cp <quelle> <ziel>`, `cp -r <verzeichnis>` (rekursiv), `cp -p` (erh√§lt Berechtigungen/Zeitstempel), `cp -a` (Archiv-Modus: `-p`, `-r` und erh√§lt Symlinks).|
|#mv|**Verschiebt oder benennt Dateien/Verzeichnisse um.**<br><br>  <br><br>**Nutzung:** `mv <quelle> <ziel>`, `mv -i` (interaktiv vor √úberschreiben), `mv -n` (kein √úberschreiben), `mv -f` (erzwingen).|
|#rm|**Entfernt Dateien oder Verzeichnisse.**<br><br>  <br><br>**Nutzung:** `rm <datei>`, `rm -r <verzeichnis>` (rekursiv), `rm -f` (erzwingt L√∂schung ohne Nachfrage), `rm -rf` (rekursiv erzwingen ‚Äì **vorsichtig verwenden!**).|
|#mkdir|**Erstellt Verzeichnisse.**<br><br>  <br><br>**Nutzung:** `mkdir <verzeichnisname>`, `mkdir -p <pfad/zum/verzeichnis>` (erstellt alle √ºbergeordneten Verzeichnisse, falls nicht vorhanden).|
|#ln|**Erstellt Links zwischen Dateien.**<br><br>  <br><br>**Nutzung:** `ln <quelle> <linkname>` (Hardlink), `ln -s <quelle> <linkname>` (Symbolischer/Softlink).|
|#chmod|**√Ñndert die Berechtigungen von Dateien/Verzeichnissen.**<br><br>  <br><br>**Nutzung (Oktal):** `chmod 755 <datei>` (rwxr-xr-x).<br><br>  <br><br>**Nutzung (Symbolisch):** `chmod u+x <datei>` (Benutzer 'x' hinzuf√ºgen), `chmod g-w <datei>` (Gruppe 'w' entfernen), `chmod -R` (rekursiv).|
|#chown|**√Ñndert den Benutzer und/oder die Gruppe von Dateien/Verzeichnissen.**<br><br>  <br><br>**Nutzung:** `chown <benutzer> <datei>`, `chown <benutzer>:<gruppe> <datei>`, `chown -R` (rekursiv).|
|#dd|**Kopiert eine Datei Block f√ºr Block, oft f√ºr Low-Level-Operationen.**<br><br>  <br><br>**Nutzung (Backup MBR):** `dd if=/dev/sda of=mbr.bak bs=512 count=1`.<br><br>  <br><br>**Nutzung (Disk-Image):** `dd if=/dev/sda of=/pfad/image.img`.<br><br>  <br><br>**Parameter:** `if=` (Input File), `of=` (Output File), `bs=` (Block Size), `count=` (Anzahl Bl√∂cke).|
|#df|**Meldet die Festplattennutzung gemounteter Dateisysteme.**<br><br>  <br><br>**Nutzung:** `df -h` (Human-readable, lesbare Gr√∂√üen), `df -T` (Dateisystem-Typ anzeigen), `df -i` (Inode-Nutzung).|
|#du|**Meldet die Festplattennutzung von Dateien/Verzeichnissen (rekursiv).**<br><br>  <br><br>**Nutzung:** `du -h <verzeichnis>` (lesbare Gr√∂√üen), `du -s` (Summe f√ºr das Verzeichnis), `du -sh *` (Summe f√ºr alle Elemente im aktuellen Verzeichnis).|
|#cat|**Konkateniert (verbindet) Dateien und gibt sie auf Standardausgabe aus.**<br><br>  <br><br>**Nutzung:** `cat <datei1> <datei2>`, `cat -n` (Zeilennummern).|
|#head / #tail|**Gibt die ersten / letzten 10 Zeilen einer Datei aus.**<br><br>  <br><br>**Nutzung:** `head -n 20 <datei>` (erste 20 Zeilen), `tail -n 5 <datei>` (letzte 5 Zeilen).<br><br>  <br><br>**Wichtig f√ºr Logs:** `tail -f /var/log/syslog` (folgt der Datei und gibt neue Zeilen live aus).|
|#wc|**Z√§hlt Zeilen, W√∂rter und Bytes in Dateien.**<br><br>  <br><br>**Nutzung:** `wc -l` (nur Zeilen), `wc -w` (nur W√∂rter), `wc -c` (nur Bytes).|
|#sort|**Sortiert die Zeilen von Textdateien.**<br><br>  <br><br>**Nutzung:** `sort -n` (numerisch), `sort -r` (reverse), `sort -k 2` (sortiere nach Feld 2), `sort -u` (nur Unikate ausgeben).|
|#uniq|**Filtert/meldet wiederholte Zeilen (ben√∂tigt sortierte Eingabe).**<br><br>  <br><br>**Nutzung:** `sort <datei> \| uniq`, `... \| uniq -c` (z√§hlt Vorkommen), `... \| uniq -d` (zeigt nur Duplikate).|
|#cut|**Schneidet Sektionen aus Zeilen aus.**<br><br>  <br><br>**Nutzung:** `cut -d':' -f1 /etc/passwd` (Trennzeichen ':', Feld 1), `cut -c 1-5` (Zeichen 1 bis 5).|
|#tee|**Liest von STDIN und schreibt auf STDOUT _und_ in eine Datei (T-St√ºck).**<br><br>  <br><br>**Nutzung:** `befehl \| tee output.log` (zeigt Ausgabe an _und_ speichert sie), `... \| tee -a output.log` (h√§ngt an Datei an).|
|#test / #[|**Pr√ºft Dateitypen und vergleicht Werte.**<br><br>  <br><br>**Nutzung (Bash-Skripting):** `if [ -f "/pfad/datei" ]; then ... fi` (pr√ºft, ob regul√§re Datei existiert), `if [ "$a" = "$b" ]; then ... fi`.|
|#id|**Meldet User-ID (UID), Group-ID (GID) und Gruppenmitgliedschaften.**<br><br>  <br><br>**Nutzung:** `id`, `id -u <user>`, `id -g <user>`.|
|#uname|**Meldet Systeminformationen.**<br><br>  <br><br>**Nutzung:** `uname -a` (Alle Infos: Kernelname, Hostname, Kernel-Version, Architektur), `uname -r` (Kernel-Release).|
|_Checksums_|**Pr√ºft oder berechnet Hash-Checksummen.**<br><br>  <br><br>**Nutzung:** `md5sum <datei>` , `sha256sum <datei>` , `b2sum <datei>`.|
|#chroot|**F√ºhrt einen Befehl mit einem spezifischen Verzeichnis als neuem Root-Verzeichnis (/) aus.**<br><br>  <br><br>**Nutzung:** `chroot /mnt/lfs /bin/bash`.|
|#mktemp|**Erstellt sichere tempor√§re Dateien oder Verzeichnisse.**<br><br>  <br><br>**Nutzung (Bash-Skripting):** `TEMP_FILE=$(mktemp)` oder `TEMP_DIR=$(mktemp -d)`.|
|#timeout|**F√ºhrt einen Befehl mit einem Zeitlimit aus.**<br><br>  <br><br>**Nutzung:** `timeout 5s ping 8.8.8.8` (bricht den Befehl nach 5 Sekunden ab).|